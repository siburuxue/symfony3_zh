

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to Load Security Users from the Database (the Entity Provider) &mdash; Symfony Framework Documentation  æ–‡æ¡£</title>
  

  
  

  
  <link href="css-family=Lato-400,700,400italic,700italic-Roboto+Slab-400,700-Inconsolata-400,700&subset=latin,cyrillic.css" tppabs="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic" rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="theme.css" tppabs="http://symfony.cn/docs/_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="stylesheet" href="custom.css" tppabs="http://symfony.cn/docs/_static/custom.css" type="text/css" />
  
    <link rel="top" title="Symfony Framework Documentation  æ–‡æ¡£" href="../../index.html"/>
        <link rel="up" title="Security" href="index.html"/>
        <link rel="next" title="How to Add â€œRemember Meâ€ Login Functionality" href="remember_me.html"/>
        <link rel="prev" title="How to Build a Traditional Login Form" href="form_login_setup.html"/> 

  
  <script src="modernizr.min.js" tppabs="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" tppabs="http://symfony.cn/docs/index.html" class="fa fa-home"> Symfony Framework Documentation</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="http://symfony.cn/docs/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html" tppabs="http://symfony.cn/docs/changelog.html">The Documentation Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#february-2015" tppabs="http://symfony.cn/docs/changelog.html#february-2015">February, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#january-2015" tppabs="http://symfony.cn/docs/changelog.html#january-2015">January, 2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#december-2014" tppabs="http://symfony.cn/docs/changelog.html#december-2014">December, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#november-2014" tppabs="http://symfony.cn/docs/changelog.html#november-2014">November, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#october-2014" tppabs="http://symfony.cn/docs/changelog.html#october-2014">October, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#september-2014" tppabs="http://symfony.cn/docs/changelog.html#september-2014">September, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#august-2014" tppabs="http://symfony.cn/docs/changelog.html#august-2014">August, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#july-2014" tppabs="http://symfony.cn/docs/changelog.html#july-2014">July, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#june-2014" tppabs="http://symfony.cn/docs/changelog.html#june-2014">June, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#may-2014" tppabs="http://symfony.cn/docs/changelog.html#may-2014">May, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#april-2014" tppabs="http://symfony.cn/docs/changelog.html#april-2014">April, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#march-2014" tppabs="http://symfony.cn/docs/changelog.html#march-2014">March, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#february-2014" tppabs="http://symfony.cn/docs/changelog.html#february-2014">February, 2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#january-2014" tppabs="http://symfony.cn/docs/changelog.html#january-2014">January, 2014</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-1.html" tppabs="http://symfony.cn/docs/quick_tour/index.html">å¿«é€Ÿå…¥é—¨</a><ul>
<li class="toctree-l2"><a class="reference internal" href="the_big_picture.html" tppabs="http://symfony.cn/docs/quick_tour/the_big_picture.html">æ€»è§ˆ</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_view.html" tppabs="http://symfony.cn/docs/quick_tour/the_view.html">è§†å›¾</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_controller.html" tppabs="http://symfony.cn/docs/quick_tour/the_controller.html">æ§åˆ¶å™¨ï¼ˆControllerï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_architecture.html" tppabs="http://symfony.cn/docs/quick_tour/the_architecture.html">ä»£ç ç»“æ„</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-2.html" tppabs="http://symfony.cn/docs/book/index.html">æ•™ç¨‹</a><ul>
<li class="toctree-l2"><a class="reference internal" href="http_fundamentals.html" tppabs="http://symfony.cn/docs/book/http_fundamentals.html">Symfonyå’ŒHTTPåŸºç¡€å·¥å…·</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_flat_php_to_symfony2.html" tppabs="http://symfony.cn/docs/book/from_flat_php_to_symfony2.html">Symfony vs çº¯PHP</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html" tppabs="http://symfony.cn/docs/book/installation.html">å®‰è£…å’Œé…ç½®Symfony</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_creation.html" tppabs="http://symfony.cn/docs/book/page_creation.html">åˆ›å»ºé¡µé¢</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller.html" tppabs="http://symfony.cn/docs/book/controller.html">æ§åˆ¶å™¨ï¼ˆControllerï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="routing.html" tppabs="http://symfony.cn/docs/book/routing.html">è·¯ç”±ï¼ˆRoutingï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="templating.html" tppabs="http://symfony.cn/docs/book/templating.html">åˆ›å»ºå’Œä½¿ç”¨æ¨¡æ¿</a></li>
<li class="toctree-l2"><a class="reference internal" href="doctrine.html" tppabs="http://symfony.cn/docs/book/doctrine.html">æ•°æ®åº“å’ŒDoctrine</a></li>
<li class="toctree-l2"><a class="reference internal" href="propel.html" tppabs="http://symfony.cn/docs/book/propel.html">æ•°æ®åº“å’ŒPropel</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html" tppabs="http://symfony.cn/docs/book/testing.html">æµ‹è¯•</a></li>
<li class="toctree-l2"><a class="reference internal" href="validation.html" tppabs="http://symfony.cn/docs/book/validation.html">æ ¡éªŒ</a></li>
<li class="toctree-l2"><a class="reference internal" href="forms.html" tppabs="http://symfony.cn/docs/book/forms.html">è¡¨å•</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html" tppabs="http://symfony.cn/docs/book/security.html">å®‰å…¨æ€§</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_cache.html" tppabs="http://symfony.cn/docs/book/http_cache.html">HTTPç¼“å­˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="translation.html" tppabs="http://symfony.cn/docs/book/translation.html">å¤šè¯­è¨€</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_container.html" tppabs="http://symfony.cn/docs/book/service_container.html">æœåŠ¡å®¹å™¨ï¼ˆService Containerï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html" tppabs="http://symfony.cn/docs/book/performance.html">æ€§èƒ½</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals.html" tppabs="http://symfony.cn/docs/book/internals.html">æ ¸å¿ƒåŠŸèƒ½</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index-3.html" tppabs="http://symfony.cn/docs/cookbook/index.html">æ‰‹å†Œ</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index-4.html" tppabs="http://symfony.cn/docs/cookbook/assetic/index.html">é™æ€æ–‡ä»¶å¤„ç†ï¼ˆAsseticï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-5.html" tppabs="http://symfony.cn/docs/cookbook/bundles/index.html">åŒ…ï¼ˆBundleï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-6.html" tppabs="http://symfony.cn/docs/cookbook/cache/index.html">ç¼“å­˜</a></li>
<li class="toctree-l2"><a class="reference internal" href="composer.html" tppabs="http://symfony.cn/docs/cookbook/composer.html">Installing Composer</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-7.html" tppabs="http://symfony.cn/docs/cookbook/configuration/index.html">é…ç½®</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-8.html" tppabs="http://symfony.cn/docs/cookbook/console/index.html">å‘½ä»¤è¡Œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-9.html" tppabs="http://symfony.cn/docs/cookbook/controller/index.html">æ§åˆ¶å™¨ï¼ˆControllerï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html" tppabs="http://symfony.cn/docs/cookbook/debugging.html">How to Optimize your Development Environment for Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-10.html" tppabs="http://symfony.cn/docs/cookbook/deployment/index.html">éƒ¨ç½²</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-11.html" tppabs="http://symfony.cn/docs/cookbook/doctrine/index.html">Doctrine</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-12.html" tppabs="http://symfony.cn/docs/cookbook/email/index.html">é‚®ä»¶</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-13.html" tppabs="http://symfony.cn/docs/cookbook/event_dispatcher/index.html">äº‹ä»¶åˆ†å‘å™¨ï¼ˆDispatcherï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-14.html" tppabs="http://symfony.cn/docs/cookbook/expression/index.html">è¡¨è¾¾å¼ï¼ˆExpressionï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-15.html" tppabs="http://symfony.cn/docs/cookbook/form/index.html">Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-16.html" tppabs="http://symfony.cn/docs/cookbook/logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-17.html" tppabs="http://symfony.cn/docs/cookbook/profiler/index.html">Profiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-18.html" tppabs="http://symfony.cn/docs/cookbook/request/index.html">Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-19.html" tppabs="http://symfony.cn/docs/cookbook/routing/index.html">Routing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index-20.html" tppabs="http://symfony.cn/docs/cookbook/security/index.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="serializer.html" tppabs="http://symfony.cn/docs/cookbook/serializer.html">How to Use the Serializer</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-21.html" tppabs="http://symfony.cn/docs/cookbook/service_container/index.html">Service Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-22.html" tppabs="http://symfony.cn/docs/cookbook/session/index.html">Sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="symfony1.html" tppabs="http://symfony.cn/docs/cookbook/symfony1.html">How Symfony2 Differs from Symfony1</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-23.html" tppabs="http://symfony.cn/docs/cookbook/templating/index.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-24.html" tppabs="http://symfony.cn/docs/cookbook/testing/index.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html" tppabs="http://symfony.cn/docs/cookbook/upgrading.html">How to Upgrade Your Symfony Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-25.html" tppabs="http://symfony.cn/docs/cookbook/validation/index.html">Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-26.html" tppabs="http://symfony.cn/docs/cookbook/web_server/index.html">Web Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-27.html" tppabs="http://symfony.cn/docs/cookbook/web_services/index.html">Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-28.html" tppabs="http://symfony.cn/docs/cookbook/workflow/index.html">Workflow</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-29.html" tppabs="http://symfony.cn/docs/best_practices/index.html">æœ€ä½³å®è·µ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html" tppabs="http://symfony.cn/docs/best_practices/introduction.html">Symfonyæ¡†æ¶æœ€ä½³å®è·µ</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-the-project.html" tppabs="http://symfony.cn/docs/best_practices/creating-the-project.html">åˆ›å»ºé¡¹ç›®</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html" tppabs="http://symfony.cn/docs/best_practices/configuration.html">é…ç½®å‚æ•°</a></li>
<li class="toctree-l2"><a class="reference internal" href="business-logic.html" tppabs="http://symfony.cn/docs/best_practices/business-logic.html">ä¸šåŠ¡é€»è¾‘ä»£ç çš„ç»„ç»‡</a></li>
<li class="toctree-l2"><a class="reference internal" href="controllers.html" tppabs="http://symfony.cn/docs/best_practices/controllers.html">æ§åˆ¶å™¨ï¼ˆControllerï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="templates.html" tppabs="http://symfony.cn/docs/best_practices/templates.html">æ¨¡æ¿</a></li>
<li class="toctree-l2"><a class="reference internal" href="forms-1.html" tppabs="http://symfony.cn/docs/best_practices/forms.html">è¡¨å•</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html" tppabs="http://symfony.cn/docs/best_practices/i18n.html">å¤šè¯­è¨€æ”¯æŒ</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-1.html" tppabs="http://symfony.cn/docs/best_practices/security.html">å®‰å…¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="web-assets.html" tppabs="http://symfony.cn/docs/best_practices/web-assets.html">é™æ€æ–‡ä»¶ï¼ˆAssetsï¼‰</a></li>
<li class="toctree-l2"><a class="reference internal" href="tests.html" tppabs="http://symfony.cn/docs/best_practices/tests.html">æµ‹è¯•</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-30.html" tppabs="http://symfony.cn/docs/components/index.html">ç»„ä»¶</a><ul>
<li class="toctree-l2"><a class="reference internal" href="using_components.html" tppabs="http://symfony.cn/docs/components/using_components.html">How to Install and Use the Symfony Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-31.html" tppabs="http://symfony.cn/docs/components/asset/index.html">Asset</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-32.html" tppabs="http://symfony.cn/docs/components/class_loader/index.html">ClassLoader</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-33.html" tppabs="http://symfony.cn/docs/components/config/index.html">Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-34.html" tppabs="http://symfony.cn/docs/components/console/index.html">Console</a></li>
<li class="toctree-l2"><a class="reference internal" href="css_selector.html" tppabs="http://symfony.cn/docs/components/css_selector.html">The CssSelector Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-35.html" tppabs="http://symfony.cn/docs/components/debug/index.html">Debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-36.html" tppabs="http://symfony.cn/docs/components/dependency_injection/index.html">DependencyInjection</a></li>
<li class="toctree-l2"><a class="reference internal" href="dom_crawler.html" tppabs="http://symfony.cn/docs/components/dom_crawler.html">The DomCrawler Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-37.html" tppabs="http://symfony.cn/docs/components/event_dispatcher/index.html">EventDispatcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-38.html" tppabs="http://symfony.cn/docs/components/expression_language/index.html">Expression Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-39.html" tppabs="http://symfony.cn/docs/components/filesystem/index.html">Filesystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="finder.html" tppabs="http://symfony.cn/docs/components/finder.html">The Finder Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-40.html" tppabs="http://symfony.cn/docs/components/form/index.html">Form</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-41.html" tppabs="http://symfony.cn/docs/components/http_foundation/index.html">HttpFoundation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-42.html" tppabs="http://symfony.cn/docs/components/http_kernel/index.html">HttpKernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="intl.html" tppabs="http://symfony.cn/docs/components/intl.html">The Intl Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="options_resolver.html" tppabs="http://symfony.cn/docs/components/options_resolver.html">The OptionsResolver Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="process.html" tppabs="http://symfony.cn/docs/components/process.html">The Process Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-43.html" tppabs="http://symfony.cn/docs/components/property_access/index.html">PropertyAccess</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-44.html" tppabs="http://symfony.cn/docs/components/routing/index.html">Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-45.html" tppabs="http://symfony.cn/docs/components/security/index.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="serializer-1.html" tppabs="http://symfony.cn/docs/components/serializer.html">The Serializer Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="stopwatch.html" tppabs="http://symfony.cn/docs/components/stopwatch.html">The Stopwatch Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-46.html" tppabs="http://symfony.cn/docs/components/templating/index.html">Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-47.html" tppabs="http://symfony.cn/docs/components/translation/index.html">Translation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-48.html" tppabs="http://symfony.cn/docs/components/var_dumper/index.html">VarDumper</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-49.html" tppabs="http://symfony.cn/docs/components/yaml/index.html">Yaml</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-50.html" tppabs="http://symfony.cn/docs/reference/index.html">å‚è€ƒ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="framework.html" tppabs="http://symfony.cn/docs/reference/configuration/framework.html">FrameworkBundle Configuration (&#8220;framework&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="doctrine-1.html" tppabs="http://symfony.cn/docs/reference/configuration/doctrine.html">DoctrineBundle Configuration (&#8220;doctrine&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-2.html" tppabs="http://symfony.cn/docs/reference/configuration/security.html">SecurityBundle Configuration (&#8220;security&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="assetic.html" tppabs="http://symfony.cn/docs/reference/configuration/assetic.html">AsseticBundle Configuration (&#8220;assetic&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="swiftmailer.html" tppabs="http://symfony.cn/docs/reference/configuration/swiftmailer.html">SwiftmailerBundle Configuration (&#8220;swiftmailer&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twig.html" tppabs="http://symfony.cn/docs/reference/configuration/twig.html">TwigBundle Configuration (&#8220;twig&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="monolog.html" tppabs="http://symfony.cn/docs/reference/configuration/monolog.html">MonologBundle Configuration (&#8220;monolog&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_profiler.html" tppabs="http://symfony.cn/docs/reference/configuration/web_profiler.html">WebProfilerBundle Configuration (&#8220;web_profiler&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel.html" tppabs="http://symfony.cn/docs/reference/configuration/kernel.html">Configuring in the Kernel (e.g. AppKernel)</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html" tppabs="http://symfony.cn/docs/reference/forms/types.html">Form Types Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="constraints.html" tppabs="http://symfony.cn/docs/reference/constraints.html">Validation Constraints Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="twig_reference.html" tppabs="http://symfony.cn/docs/reference/forms/twig_reference.html">Twig Template Form Function and Variable Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="twig_reference-1.html" tppabs="http://symfony.cn/docs/reference/twig_reference.html">Symfony Twig Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dic_tags.html" tppabs="http://symfony.cn/docs/reference/dic_tags.html">The Dependency Injection Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html" tppabs="http://symfony.cn/docs/reference/requirements.html">Requirements for Running Symfony</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-51.html" tppabs="http://symfony.cn/docs/contributing/index.html">è´¡çŒ®</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index-52.html" tppabs="http://symfony.cn/docs/contributing/code/index.html">è´¡çŒ®ä»£ç </a></li>
<li class="toctree-l2"><a class="reference internal" href="index-53.html" tppabs="http://symfony.cn/docs/contributing/documentation/index.html">è´¡çŒ®æ–‡æ¡£</a></li>
<li class="toctree-l2"><a class="reference internal" href="index-54.html" tppabs="http://symfony.cn/docs/contributing/community/index.html">ç¤¾åŒº</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html" tppabs="http://symfony.cn/docs/index.html">Symfony Framework Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" tppabs="http://symfony.cn/docs/index.html">Docs</a> &raquo;</li>
      
          <li><a href="index-3.html" tppabs="http://symfony.cn/docs/cookbook/index.html">æ‰‹å†Œ</a> &raquo;</li>
      
          <li><a href="index-20.html" tppabs="http://symfony.cn/docs/cookbook/security/index.html">Security</a> &raquo;</li>
      
    <li>How to Load Security Users from the Database (the Entity Provider)</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="entity_provider.txt.htm" tppabs="http://symfony.cn/docs/_sources/cookbook/security/entity_provider.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="how-to-load-security-users-from-the-database-the-entity-provider">
<span id="index-0"></span><h1>How to Load Security Users from the Database (the Entity Provider)<a class="headerlink" href="#how-to-load-security-users-from-the-database-the-entity-provider" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<p>Symfony&#8217;s security system can load security users from anywhere - like a
database, via Active Directory or an OAuth server. This article will show
you how to load your users from the database via a Doctrine entity.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<div class="admonition tip">
<p class="first admonition-title">å°æŠ€å·§</p>
<p class="last">Before you start, you should check out <a class="reference external" href="javascript:if(confirm('https://github.com/FriendsOfSymfony/FOSUserBundle  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/FriendsOfSymfony/FOSUserBundle'" tppabs="https://github.com/FriendsOfSymfony/FOSUserBundle">FOSUserBundle</a>. This external
bundle allows you to load users from the database (like you&#8217;ll learn here)
<em>and</em> gives you built-in routes &amp; controllers for things like login,
registration and forgot password. But, if you need to heavily customize
your user system <em>or</em> if you want to learn how things work, this tutorial
is even better.</p>
</div>
<p>Loading users via a Doctrine entity has 2 basic steps:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#security-crete-user-entity"><span>Create your User entity</span></a></li>
<li><a class="reference internal" href="#security-config-entity-provider"><span>Configure security.yml to load from your entity</span></a></li>
</ol>
<p>Afterwards, you can learn more about <a class="reference internal" href="#security-advanced-user-interface"><span>forbidding inactive users</span></a>,
<a class="reference internal" href="#authenticating-someone-with-a-custom-entity-provider"><span>using a custom query</span></a>
and <a class="reference internal" href="#cookbook-security-serialize-equatable"><span>user serialization to the session</span></a></p>
</div>
<div class="section" id="create-your-user-entity">
<span id="the-data-model"></span><span id="security-crete-user-entity"></span><h2>1) Create your User Entity<a class="headerlink" href="#create-your-user-entity" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>For this entry, suppose that you already have a <code class="docutils literal"><span class="pre">User</span></code> entity inside an
<code class="docutils literal"><span class="pre">AppBundle</span></code> with the following fields: <code class="docutils literal"><span class="pre">id</span></code>, <code class="docutils literal"><span class="pre">username</span></code>, <code class="docutils literal"><span class="pre">password</span></code>,
<code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">isActive</span></code>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/AppBundle/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\UserInterface</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Table(name=&quot;app_users&quot;)</span>
<span class="sd"> * @ORM\Entity(repositoryClass=&quot;AppBundle\Entity\UserRepository&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">UserInterface</span><span class="p">,</span> <span class="nx">\Serializable</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;integer&quot;)</span>
<span class="sd">     * @ORM\Id</span>
<span class="sd">     * @ORM\GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;, length=25, unique=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$username</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;, length=64)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$password</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;, length=60, unique=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$email</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(name=&quot;is_active&quot;, type=&quot;boolean&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$isActive</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isActive</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">// may not be needed, see section on salt below</span>
        <span class="c1">// $this-&gt;salt = md5(uniqid(null, true));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUsername</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSalt</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// you *may* need a real salt depending on your encoder</span>
        <span class="c1">// see section on salt below</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPassword</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRoles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">eraseCredentials</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="sd">/** @see \Serializable::serialize() */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">serialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">,</span>
            <span class="c1">// see section on salt below</span>
            <span class="c1">// $this-&gt;salt,</span>
        <span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/** @see \Serializable::unserialize() */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">list</span> <span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">,</span>
            <span class="c1">// see section on salt below</span>
            <span class="c1">// $this-&gt;salt</span>
        <span class="p">)</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To make things shorter, some of the getter and setter methods aren&#8217;t shown.
But you can <a class="reference internal" href="doctrine.html#book-doctrine-generating-getters-and-setters" tppabs="http://symfony.cn/docs/book/doctrine.html#book-doctrine-generating-getters-and-setters"><span>generate</span></a> these
by running:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console doctrine:generate:entities AppBundle/Entity/User
</pre></div>
</div>
<p>Next, make sure to <a class="reference internal" href="doctrine.html#book-doctrine-creating-the-database-tables-schema" tppabs="http://symfony.cn/docs/book/doctrine.html#book-doctrine-creating-the-database-tables-schema"><span>create the database table</span></a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console doctrine:schema:update --force
</pre></div>
</div>
<div class="section" id="what-s-this-userinterface">
<h3>What&#8217;s this UserInterface?<a class="headerlink" href="#what-s-this-userinterface" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>So far, this is just a normal entity. But in order to use this class in the
security system, it must implement
<code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html" title="Symfony\Component\Security\Core\User\UserInterface"><span class="pre">UserInterface</span></a></code>. This
forces the class to have the five following methods:</p>
<ul class="simple">
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getRoles'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getRoles" title="Symfony\Component\Security\Core\User\UserInterface::getRoles()"><span class="pre">getRoles()</span></a></code></li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getPassword'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getPassword" title="Symfony\Component\Security\Core\User\UserInterface::getPassword()"><span class="pre">getPassword()</span></a></code></li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getSalt'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getSalt" title="Symfony\Component\Security\Core\User\UserInterface::getSalt()"><span class="pre">getSalt()</span></a></code></li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getUsername'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_getUsername" title="Symfony\Component\Security\Core\User\UserInterface::getUsername()"><span class="pre">getUsername()</span></a></code></li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_eraseCredentials'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html#method_eraseCredentials" title="Symfony\Component\Security\Core\User\UserInterface::eraseCredentials()"><span class="pre">eraseCredentials()</span></a></code></li>
</ul>
<p>To learn more about each of these, see <code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html" title="Symfony\Component\Security\Core\User\UserInterface"><span class="pre">UserInterface</span></a></code>.</p>
</div>
<div class="section" id="what-do-the-serialize-and-unserialize-methods-do">
<h3>What do the serialize and unserialize Methods do?<a class="headerlink" href="#what-do-the-serialize-and-unserialize-methods-do" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>At the end of each request, the User object is serialized to the session.
On the next request, it&#8217;s unserialized. To help PHP do this correctly, you
need to implement <code class="docutils literal"><span class="pre">Serializable</span></code>. But you don&#8217;t need to serialize everything:
you only need a few fields (the ones shown above plus a few extra if you
decide to implement <a class="reference internal" href="#security-advanced-user-interface"><span>AdvancedUserInterface</span></a>).
On each request, the <code class="docutils literal"><span class="pre">id</span></code> is used to query for a fresh <code class="docutils literal"><span class="pre">User</span></code> object
from the database.</p>
<p>Want to know more? See <a class="reference internal" href="#cookbook-security-serialize-equatable"><span>Understanding serialize and how a User is Saved in the Session</span></a>.</p>
</div>
</div>
<div class="section" id="configure-security-to-load-from-your-entity">
<span id="security-config-entity-provider"></span><span id="authenticating-someone-against-a-database"></span><h2>2) Configure Security to load from your Entity<a class="headerlink" href="#configure-security-to-load-from-your-entity" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>Now that you have a <code class="docutils literal"><span class="pre">User</span></code> entity that implements <code class="docutils literal"><span class="pre">UserInterface</span></code>, you
just need to tell Symfony&#8217;s security system about it in <code class="docutils literal"><span class="pre">security.yml</span></code>.</p>
<p>In this example, the user will enter their username and password via HTTP
basic authentication. Symfony will query for a <code class="docutils literal"><span class="pre">User</span></code> entity matching
the username and then check the password (more on passwords in a moment):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">encoders</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">AppBundle\Entity\User</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">algorithm</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bcrypt</span>

    <span class="c1"># ...</span>

    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">our_db_provider</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">entity</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AppBundle:User</span>
                <span class="l-Scalar-Plain">property</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">username</span>
                <span class="c1"># if you&#39;re using multiple entity managers</span>
                <span class="c1"># manager_name: customer</span>

    <span class="l-Scalar-Plain">firewalls</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>    <span class="l-Scalar-Plain">^/</span>
            <span class="l-Scalar-Plain">http_basic</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="l-Scalar-Plain">provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">our_db_provider</span>

    <span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;AppBundle\Entity\User&quot;</span>
        <span class="na">algorithm=</span><span class="s">&quot;bcrypt&quot;</span>
    <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;our_db_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">class=</span><span class="s">&quot;AppBundle:User&quot;</span> <span class="na">property=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>

    <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="na">pattern=</span><span class="s">&quot;^/&quot;</span> <span class="na">provider=</span><span class="s">&quot;our_db_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;http-basic</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/firewall&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;AppBundle\Entity\User&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;algorithm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bcrypt&#39;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;our_db_provider&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;entity&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;class&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:User&#39;</span><span class="p">,</span>
                <span class="s1">&#39;property&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;pattern&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;http_basic&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
            <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;our_db_provider&#39;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>First, the <code class="docutils literal"><span class="pre">encoders</span></code> section tells Symfony to expect that the passwords
in the database will be encoded using <code class="docutils literal"><span class="pre">bcrypt</span></code>. Second, the <code class="docutils literal"><span class="pre">providers</span></code>
section creates a &#8220;user provider&#8221; called <code class="docutils literal"><span class="pre">our_db_provider</span></code> that knows to
query from your <code class="docutils literal"><span class="pre">AppBundle:User</span></code> entity by the <code class="docutils literal"><span class="pre">username</span></code> property. The
name <code class="docutils literal"><span class="pre">our_db_provider</span></code> isn&#8217;t important: it just needs to match the value
of the <code class="docutils literal"><span class="pre">provider</span></code> key under your firewall. Or, if you don&#8217;t set the <code class="docutils literal"><span class="pre">provider</span></code>
key under your firewall, the first &#8220;user provider&#8221; is automatically used.</p>
<div class="admonition caution">
<p class="first admonition-title">è­¦å‘Š</p>
<p>If you&#8217;re using PHP 5.4 or lower, you&#8217;ll need to install the <code class="docutils literal"><span class="pre">ircmaxell/password-compat</span></code>
library via Composer in order to be able to use the <code class="docutils literal"><span class="pre">bcrypt</span></code> encoder:</p>
<div class="last highlight-json"><div class="highlight"><pre>{
    &quot;require&quot;: {
        ...
        &quot;ircmaxell/password-compat&quot;: &quot;~1.0.3&quot;
    }
}
</pre></div>
</div>
</div>
<div class="section" id="creating-your-first-user">
<h3>Creating your First User<a class="headerlink" href="#creating-your-first-user" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>To add users, you can implement a <a class="reference internal" href="registration_form.html" tppabs="http://symfony.cn/docs/cookbook/doctrine/registration_form.html"><em>registration form</em></a>
or add some <a class="reference external" href="javascript:if(confirm('http://symfony.com/doc/master/bundles/DoctrineFixturesBundle/index.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://symfony.com/doc/master/bundles/DoctrineFixturesBundle/index.html'" tppabs="http://symfony.com/doc/master/bundles/DoctrineFixturesBundle/index.html">fixtures</a>. This is just a normal entity, so there&#8217;s nothing
tricky, <em>except</em> that you need to encode each user&#8217;s password. But don&#8217;t
worry, Symfony gives you a service that will do this for you. See <a class="reference internal" href="security.html#security-encoding-password" tppabs="http://symfony.cn/docs/book/security.html#security-encoding-password"><span>åŠ¨æ€åŠ å¯†å¯†ç </span></a>
for details.</p>
<p>Below is an export of the <code class="docutils literal"><span class="pre">app_users</span></code> table from MySQL with user <code class="docutils literal"><span class="pre">admin</span></code>
and password <code class="docutils literal"><span class="pre">admin</span></code> (which has been encoded).</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mysql&gt; SELECT * FROM app_users<span class="p">;</span>
+----+----------+------------------------------------------+--------------------+-----------+
<span class="p">|</span> id <span class="p">|</span> username <span class="p">|</span> password                                 <span class="p">|</span> email              <span class="p">|</span> is_active <span class="p">|</span>
+----+----------+------------------------------------------+--------------------+-----------+
<span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> admin    <span class="p">|</span> d033e22ae348aeb5660fc2140aec35850c4da997 <span class="p">|</span> admin@example.com  <span class="p">|</span>         <span class="m">1</span> <span class="p">|</span>
+----+----------+------------------------------------------+--------------------+-----------+
</pre></div>
</div>
<div class="sidebar">
<p class="first sidebar-title">Do you need to a Salt property?</p>
<p class="last">If you use <code class="docutils literal"><span class="pre">bcrypt</span></code>, no. Otherwise, yes. All passwords must be hashed
with a salt, but <code class="docutils literal"><span class="pre">bcrypt</span></code> does this internally. Since this tutorial
<em>does</em> use <code class="docutils literal"><span class="pre">bcrypt</span></code>, the <code class="docutils literal"><span class="pre">getSalt()</span></code> method in <code class="docutils literal"><span class="pre">User</span></code> can just
return <code class="docutils literal"><span class="pre">null</span></code> (it&#8217;s not used). If you use a different algorithm, you&#8217;ll
need to uncomment the <code class="docutils literal"><span class="pre">salt</span></code> lines in the <code class="docutils literal"><span class="pre">User</span></code> entity and add a
persisted <code class="docutils literal"><span class="pre">salt</span></code> property.</p>
</div>
</div>
</div>
<div class="section" id="forbid-inactive-users-advanceduserinterface">
<span id="security-advanced-user-interface"></span><h2>Forbid Inactive Users (AdvancedUserInterface)<a class="headerlink" href="#forbid-inactive-users-advanceduserinterface" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>If a User&#8217;s <code class="docutils literal"><span class="pre">isActive</span></code> property is set to <code class="docutils literal"><span class="pre">false</span></code> (i.e. <code class="docutils literal"><span class="pre">is_active</span></code>
is 0 in the database), the user will still be able to login to the site
normally. This is easily fixable.</p>
<p>To exclude inactive users, change your <code class="docutils literal"><span class="pre">User</span></code> clas to implement
<code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html" title="Symfony\Component\Security\Core\User\AdvancedUserInterface"><span class="pre">AdvancedUserInterface</span></a></code>.
This extends <code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface.html" title="Symfony\Component\Security\Core\User\UserInterface"><span class="pre">UserInterface</span></a></code>,
so you only need the new interface:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/AppBundle/Entity/User.php</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\AdvancedUserInterface</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">AdvancedUserInterface</span><span class="p">,</span> <span class="nx">\Serializable</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isAccountNonExpired</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isAccountNonLocked</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isCredentialsNonExpired</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isEnabled</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isActive</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// serialize and unserialize must be updated - see below</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">serialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">serialize</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isActive</span>
        <span class="p">));</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">list</span> <span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isActive</span>
        <span class="p">)</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html" title="Symfony\Component\Security\Core\User\AdvancedUserInterface"><span class="pre">AdvancedUserInterface</span></a></code>
interface adds four extra methods to validate the account status:</p>
<ul class="simple">
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isAccountNonExpired'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isAccountNonExpired" title="Symfony\Component\Security\Core\User\AdvancedUserInterface::isAccountNonExpired()"><span class="pre">isAccountNonExpired()</span></a></code>
checks whether the user&#8217;s account has expired;</li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isAccountNonLocked'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isAccountNonLocked" title="Symfony\Component\Security\Core\User\AdvancedUserInterface::isAccountNonLocked()"><span class="pre">isAccountNonLocked()</span></a></code>
checks whether the user is locked;</li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isCredentialsNonExpired'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isCredentialsNonExpired" title="Symfony\Component\Security\Core\User\AdvancedUserInterface::isCredentialsNonExpired()"><span class="pre">isCredentialsNonExpired()</span></a></code>
checks whether the user&#8217;s credentials (password) has expired;</li>
<li><code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isEnabled'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/AdvancedUserInterface.html#method_isEnabled" title="Symfony\Component\Security\Core\User\AdvancedUserInterface::isEnabled()"><span class="pre">isEnabled()</span></a></code>
checks whether the user is enabled.</li>
</ul>
<p>If <em>any</em> of these return <code class="docutils literal"><span class="pre">false</span></code>, the user won&#8217;t be allowed to login. You
can choose to have persisted properties for all of these, or whatever you
need (in this example, only <code class="docutils literal"><span class="pre">isActive</span></code> pulls from the database).</p>
<p>So what&#8217;s the difference between the methods? Each returns a slightly different
error message (and these can be translated when you render them in your login
template to customize them further).</p>
<div class="admonition note">
<p class="first admonition-title">æ³¨è§£</p>
<p class="last">If you use <code class="docutils literal"><span class="pre">AdvancedUserInterface</span></code>, you also need to add any of the
properties used by these methods (like <code class="docutils literal"><span class="pre">isActive</span></code>) to the <code class="docutils literal"><span class="pre">serialize()</span></code>
and <code class="docutils literal"><span class="pre">unserialize()</span></code> methods. If you <em>don&#8217;t</em> do this, your user may
not be deserialized correctly from the session on each request.</p>
</div>
<p>Congrats! Your database-loading security system is all setup! Next, add a
true <a class="reference internal" href="form_login.html" tppabs="http://symfony.cn/docs/cookbook/security/form_login.html"><em>login form</em></a> instead of HTTP Basic
or keep reading for other topics.</p>
</div>
<div class="section" id="using-a-custom-query-to-load-the-user">
<span id="authenticating-someone-with-a-custom-entity-provider"></span><h2>Using a Custom Query to Load the User<a class="headerlink" href="#using-a-custom-query-to-load-the-user" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>It would be great if a user could login with their username <em>or</em> email, as
both are unique in the database. Unfortunately, the native entity provider
is only able to handle querying via a single property on the user.</p>
<p>To do this, make your <code class="docutils literal"><span class="pre">UserRepository</span></code> implement a special
<code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserProviderInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserProviderInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserProviderInterface.html" title="Symfony\Component\Security\Core\User\UserProviderInterface"><span class="pre">UserProviderInterface</span></a></code>. This
interface requires three methods: <code class="docutils literal"><span class="pre">loadUserByUsername($username)</span></code>,
<code class="docutils literal"><span class="pre">refreshUser(UserInterface</span> <span class="pre">$user)</span></code>, and <code class="docutils literal"><span class="pre">supportsClass($class)</span></code>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/AppBundle/Entity/UserRepository.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\UserInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\UserProviderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Exception\UsernameNotFoundException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Exception\UnsupportedUserException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserRepository</span> <span class="k">extends</span> <span class="nx">EntityRepository</span> <span class="k">implements</span> <span class="nx">UserProviderInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">loadUserByUsername</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = :username OR u.email = :email&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">getOneOrNullResult</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span>
                <span class="s1">&#39;Unable to find an active admin AppBundle:User object identified by &quot;%s&quot;.&#39;</span><span class="p">,</span>
                <span class="nv">$username</span>
            <span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UsernameNotFoundException</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">refreshUser</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$class</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">supportsClass</span><span class="p">(</span><span class="nv">$class</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnsupportedUserException</span><span class="p">(</span>
                <span class="nb">sprintf</span><span class="p">(</span>
                    <span class="s1">&#39;Instances of &quot;%s&quot; are not supported.&#39;</span><span class="p">,</span>
                    <span class="nv">$class</span>
                <span class="p">)</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">supportsClass</span><span class="p">(</span><span class="nv">$class</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityName</span><span class="p">()</span> <span class="o">===</span> <span class="nv">$class</span>
            <span class="o">||</span> <span class="nb">is_subclass_of</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityName</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more details on these methods, see <code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserProviderInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserProviderInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserProviderInterface.html" title="Symfony\Component\Security\Core\User\UserProviderInterface"><span class="pre">UserProviderInterface</span></a></code>.</p>
<div class="admonition tip">
<p class="first admonition-title">å°æŠ€å·§</p>
<p class="last">Don&#8217;t forget to add the repository class to the
<a class="reference internal" href="doctrine.html#book-doctrine-custom-repository-classes" tppabs="http://symfony.cn/docs/book/doctrine.html#book-doctrine-custom-repository-classes"><span>mapping definition of your entity</span></a>.</p>
</div>
<p>To finish this, just remove the <code class="docutils literal"><span class="pre">property</span></code> key from the user provider in
<code class="docutils literal"><span class="pre">security.yml</span></code>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/security.yml</span>
<span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l-Scalar-Plain">providers</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">our_db_provider</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">entity</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AppBundle:User</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/security.xml --&gt;</span>
<span class="nt">&lt;config&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;our_db_provider&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;entity</span> <span class="na">class=</span><span class="s">&quot;AppBundle:User&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/provider&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="c1">// app/config/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;our_db_provider&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;entity&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AppBundle:User&#39;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="o">...</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>This tells Symfony to <em>not</em> query automatically for the User. Instead, when
someone logs in, the <code class="docutils literal"><span class="pre">loadUserByUsername()</span></code> method on <code class="docutils literal"><span class="pre">UserRepository</span></code>
will be called.</p>
</div>
<div class="section" id="managing-roles-in-the-database">
<h2>Managing Roles in the Database<a class="headerlink" href="#managing-roles-in-the-database" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>The end of this tutorial focuses on how to store and retrieve a list of roles
from the database. As mentioned previously, when your user is loaded, its
<code class="docutils literal"><span class="pre">getRoles()</span></code> method returns the array of security roles that should be
assigned to the user. You can load this data from anywhere - a hardcoded
list used for all users (e.g. <code class="docutils literal"><span class="pre">array('ROLE_USER')</span></code>), a Doctrine array
property called <code class="docutils literal"><span class="pre">roles</span></code>, or via a Doctrine relationship, as you&#8217;ll learn
about in this section.</p>
<div class="admonition caution">
<p class="first admonition-title">è­¦å‘Š</p>
<p class="last">In a typical setup, you should always return at least 1 role from the <code class="docutils literal"><span class="pre">getRoles()</span></code>
method. By convention, a role called <code class="docutils literal"><span class="pre">ROLE_USER</span></code> is usually returned.
If you fail to return any roles, it may appear as if your user isn&#8217;t
authenticated at all.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">è­¦å‘Š</p>
<p class="last">In order to work with the security configuration examples on this page
all roles must be prefixed with <code class="docutils literal"><span class="pre">ROLE_</span></code> (see
the <a class="reference internal" href="security.html#book-security-roles" tppabs="http://symfony.cn/docs/book/security.html#book-security-roles"><span>section about roles</span></a> in the book). For
example, your roles will be <code class="docutils literal"><span class="pre">ROLE_ADMIN</span></code> or <code class="docutils literal"><span class="pre">ROLE_USER</span></code> instead of
<code class="docutils literal"><span class="pre">ADMIN</span></code> or <code class="docutils literal"><span class="pre">USER</span></code>.</p>
</div>
<p>In this example, the <code class="docutils literal"><span class="pre">AppBundle:User</span></code> entity class defines a
many-to-many relationship with a <code class="docutils literal"><span class="pre">AppBundle:Role</span></code> entity class.
A user can be related to several roles and a role can be composed of
one or more users. The previous <code class="docutils literal"><span class="pre">getRoles()</span></code> method now returns
the list of related roles. Notice that <code class="docutils literal"><span class="pre">__construct()</span></code> and <code class="docutils literal"><span class="pre">getRoles()</span></code>
methods have changed:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/AppBundle/Entity/User.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">AdvancedUserInterface</span><span class="p">,</span> <span class="nx">\Serializable</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\ManyToMany(targetEntity=&quot;Role&quot;, inversedBy=&quot;users&quot;)</span>
<span class="sd">     *</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$roles</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">roles</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRoles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">roles</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">AppBundle:Role</span></code> entity class defines three fields (<code class="docutils literal"><span class="pre">id</span></code>,
<code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">role</span></code>). The unique <code class="docutils literal"><span class="pre">role</span></code> field contains the role name
(e.g. <code class="docutils literal"><span class="pre">ROLE_ADMIN</span></code>) used by the Symfony security layer to secure parts
of the application:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/AppBundle/Entity/Role.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Role\RoleInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Table(name=&quot;app_role&quot;)</span>
<span class="sd"> * @ORM\Entity()</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Role</span> <span class="k">implements</span> <span class="nx">RoleInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(name=&quot;id&quot;, type=&quot;integer&quot;)</span>
<span class="sd">     * @ORM\Id()</span>
<span class="sd">     * @ORM\GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(name=&quot;name&quot;, type=&quot;string&quot;, length=30)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(name=&quot;role&quot;, type=&quot;string&quot;, length=20, unique=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$role</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\ManyToMany(targetEntity=&quot;User&quot;, mappedBy=&quot;roles&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$users</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">users</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @see RoleInterface</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRole</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">role</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ... getters and setters for each property</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For brevity, the getter and setter methods are hidden, but you can
<a class="reference internal" href="doctrine.html#book-doctrine-generating-getters-and-setters" tppabs="http://symfony.cn/docs/book/doctrine.html#book-doctrine-generating-getters-and-setters"><span>generate them</span></a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console doctrine:generate:entities AppBundle/Entity/User
</pre></div>
</div>
<p>Don&#8217;t forget also to update your database schema:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>php app/console doctrine:schema:update --force
</pre></div>
</div>
<p>This will create the <code class="docutils literal"><span class="pre">app_role</span></code> table and a <code class="docutils literal"><span class="pre">user_role</span></code> that stores
the many-to-many relationship between <code class="docutils literal"><span class="pre">app_user</span></code> and <code class="docutils literal"><span class="pre">app_role</span></code>. If
you had one user linked to one role, your database might look something like
this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mysql&gt; SELECT * FROM app_role<span class="p">;</span>
+----+-------+------------+
<span class="p">|</span> id <span class="p">|</span> name  <span class="p">|</span> role       <span class="p">|</span>
+----+-------+------------+
<span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> admin <span class="p">|</span> ROLE_ADMIN <span class="p">|</span>
+----+-------+------------+

<span class="nv">$ </span>mysql&gt; SELECT * FROM user_role<span class="p">;</span>
+---------+---------+
<span class="p">|</span> user_id <span class="p">|</span> role_id <span class="p">|</span>
+---------+---------+
<span class="p">|</span>       <span class="m">1</span> <span class="p">|</span>       <span class="m">1</span> <span class="p">|</span>
+---------+---------+
</pre></div>
</div>
<p>And that&#8217;s it! When the user logs in, Symfony security system will call the
<code class="docutils literal"><span class="pre">User::getRoles</span></code> method. This will return an array of <code class="docutils literal"><span class="pre">Role</span></code> objects
that Symfony will use to determine if the user should have access to certain
parts of the system.</p>
<div class="sidebar">
<p class="first sidebar-title">What&#8217;s the purpose of the RoleInterface?</p>
<p class="last">Notice that the <code class="docutils literal"><span class="pre">Role</span></code> class implements
<code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/Role/RoleInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/Role/RoleInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/Role/RoleInterface.html" title="Symfony\Component\Security\Core\Role\RoleInterface"><span class="pre">RoleInterface</span></a></code>. This is
because Symfony&#8217;s security system requires that the <code class="docutils literal"><span class="pre">User::getRoles</span></code> method
returns an array of either role strings or objects that implement this interface.
If <code class="docutils literal"><span class="pre">Role</span></code> didn&#8217;t implement this interface, then <code class="docutils literal"><span class="pre">User::getRoles</span></code>
would need to iterate over all the <code class="docutils literal"><span class="pre">Role</span></code> objects, call <code class="docutils literal"><span class="pre">getRole</span></code>
on each, and create an array of strings to return. Both approaches are
valid and equivalent.</p>
</div>
<div class="section" id="improving-performance-with-a-join">
<span id="cookbook-doctrine-entity-provider-role-db-schema"></span><h3>Improving Performance with a Join<a class="headerlink" href="#improving-performance-with-a-join" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h3>
<p>To improve performance and avoid lazy loading of roles when retrieving a user
from the custom entity provider, you can use a Doctrine join to the roles
relationship in the <code class="docutils literal"><span class="pre">UserRepository::loadUserByUsername()</span></code> method. This will
fetch the user and their associated roles with a single query:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="c1">// src/AppBundle/Entity/UserRepository.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">UserRepository</span> <span class="k">extends</span> <span class="nx">EntityRepository</span> <span class="k">implements</span> <span class="nx">UserProviderInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">loadUserByUsername</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$q</span> <span class="o">=</span> <span class="nv">$this</span>
            <span class="o">-&gt;</span><span class="na">createQueryBuilder</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;u, r&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span><span class="s1">&#39;u.roles&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;u.username = :username OR u.email = :email&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getQuery</span><span class="p">();</span>

        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">QueryBuilder::leftJoin()</span></code> method joins and fetches related roles from
the <code class="docutils literal"><span class="pre">AppBundle:User</span></code> model class when a user is retrieved by their email
address or username.</p>
</div>
</div>
<div class="section" id="understanding-serialize-and-how-a-user-is-saved-in-the-session">
<span id="cookbook-security-serialize-equatable"></span><h2>Understanding serialize and how a User is Saved in the Session<a class="headerlink" href="#understanding-serialize-and-how-a-user-is-saved-in-the-session" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>If you&#8217;re curious about the importance of the <code class="docutils literal"><span class="pre">serialize()</span></code> method inside
the <code class="docutils literal"><span class="pre">User</span></code> class or how the User object is serialized or deserialized, then
this section is for you. If not, feel free to skip this.</p>
<p>Once the user is logged in, the entire User object is serialized into the
session. On the next request, the User object is deserialized. Then, the value
of the <code class="docutils literal"><span class="pre">id</span></code> property is used to re-query for a fresh User object from the
database. Finally, the fresh User object is compared to the deserialized
User object to make sure that they represent the same user. For example, if
the <code class="docutils literal"><span class="pre">username</span></code> on the 2 User objects doesn&#8217;t match for some reason, then
the user will be logged out for security reasons.</p>
<p>Even though this all happens automatically, there are a few important side-effects.</p>
<p>First, the <code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://php.net/manual/en/class.serializable.php  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://php.net/manual/en/class.serializable.php'" tppabs="http://php.net/manual/en/class.serializable.php" title="Serializable"><span class="pre">Serializable</span></a></code> interface and its <code class="docutils literal"><span class="pre">serialize</span></code> and <code class="docutils literal"><span class="pre">unserialize</span></code>
methods have been added to allow the <code class="docutils literal"><span class="pre">User</span></code> class to be serialized
to the session. This may or may not be needed depending on your setup,
but it&#8217;s probably a good idea. In theory, only the <code class="docutils literal"><span class="pre">id</span></code> needs to be serialized,
because the <code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Bridge/Doctrine/Security/User/EntityUserProvider.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Bridge/Doctrine/Security/User/EntityUserProvider.html#method_refreshUser'" tppabs="http://api.symfony.com/master/Symfony/Bridge/Doctrine/Security/User/EntityUserProvider.html#method_refreshUser" title="Symfony\Bridge\Doctrine\Security\User\EntityUserProvider::refreshUser()"><span class="pre">refreshUser()</span></a></code>
method refreshes the user on each request by using the <code class="docutils literal"><span class="pre">id</span></code> (as explained
above). This gives us a &#8220;fresh&#8221; User object.</p>
<p>But Symfony also uses the <code class="docutils literal"><span class="pre">username</span></code>, <code class="docutils literal"><span class="pre">salt</span></code>, and <code class="docutils literal"><span class="pre">password</span></code> to verify
that the User has not changed between requests (it also calls your <code class="docutils literal"><span class="pre">AdvancedUserInterface</span></code>
methods if you implement it). Failing to serialize these may cause you to
be logged out on each request. If your User implements the
<code class="docutils literal"><a class="reference external" href="javascript:if(confirm('http://api.symfony.com/master/Symfony/Component/Security/Core/User/EquatableInterface.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://api.symfony.com/master/Symfony/Component/Security/Core/User/EquatableInterface.html'" tppabs="http://api.symfony.com/master/Symfony/Component/Security/Core/User/EquatableInterface.html" title="Symfony\Component\Security\Core\User\EquatableInterface"><span class="pre">EquatableInterface</span></a></code>,
then instead of these properties being checked, your <code class="docutils literal"><span class="pre">isEqualTo</span></code> method
is simply called, and you can check whatever properties you want. Unless
you understand this, you probably <em>won&#8217;t</em> need to implement this interface
or worry about it.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="remember_me.html" tppabs="http://symfony.cn/docs/cookbook/security/remember_me.html" class="btn btn-neutral float-right" title="How to Add â€œRemember Meâ€ Login Functionality">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="form_login_setup.html" tppabs="http://symfony.cn/docs/cookbook/security/form_login_setup.html" class="btn btn-neutral" title="How to Build a Traditional Login Form"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; ç‰ˆæƒæ‰€æœ‰ Creative Commons Attribution-Share Alike 3.0 Unported.
    </p>
  </div>

  Built with <a href="javascript:if(confirm('http://sphinx-doc.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://sphinx-doc.org/'" tppabs="http://sphinx-doc.org/">Sphinx</a> using a <a href="javascript:if(confirm('https://github.com/snide/sphinx_rtd_theme  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/snide/sphinx_rtd_theme'" tppabs="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="javascript:if(confirm('https://readthedocs.org/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://readthedocs.org/'" tppabs="https://readthedocs.org/">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="jquery.js" tppabs="http://symfony.cn/docs/_static/jquery.js"></script>
      <script type="text/javascript" src="underscore.js" tppabs="http://symfony.cn/docs/_static/underscore.js"></script>
      <script type="text/javascript" src="doctools.js" tppabs="http://symfony.cn/docs/_static/doctools.js"></script>
      <script type="text/javascript" src="translations.js" tppabs="http://symfony.cn/docs/_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="theme.js" tppabs="http://symfony.cn/docs/_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>